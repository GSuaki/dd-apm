# Builder
FROM mwendler/wget as builder

RUN rm -rf newrelic && \
  wget --no-check-certificate "https://download.newrelic.com/newrelic/java-agent/newrelic-agent/current/newrelic-java.zip" && \
   unzip newrelic-java.zip && \
   rm -f newrelic-java.zip.zip

# API
FROM adoptopenjdk/openjdk11-openj9:x86_64-alpine-jre11u-nightly

COPY . /app
COPY --from=builder newrelic /app/newrelic

COPY newrelic.yml /app/newrelic/newrelic.yml
COPY build/libs/code-drafts-*.jar /app/api.jar

WORKDIR /app

CMD java -server -javaagent:newrelic/newrelic.jar -jar api.jar